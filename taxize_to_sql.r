#list_loop todos 
#list_tsn
library(taxize)
#list_tsn2 <- c("117597", "154193", "118700", "117556", "154348", "118830", "117278", "114262", "114262", "112756", "153360", "113835", "117541", "117602", "114030", "678328", "117236", "693972", "117626", "114387", "117318", "117511", "117276", "117268", "113831", "117267", "118739", "117852", "114265", "117641", "117551", "114493", "118707", "117293", "117640", "117856", "693980", "118716", "693997", "694071", "693994", "708702", "42234", "808676", "808728", "188443", "808687", "808691", "808736", "808712", "808766", "808731", "808705", "808740", "834316", "186582", "113838", "834318", "834323", "834312", "834300", "834310", "834315", "931439", "931456", "931448", "110436", "111561", "111689", "109660", "931457", "111703", "110982", "111590", "111544", "111369", "111686", "109681", "931461", "111610", "110444", "111612", "111203", "110441", "111516", "109548", "110742", "111139", "931449", "111509", "109589", "111131", "110842", "111584", "111129", "110738", "109638", "111314", "110237", "111492", "111536", "111737", "702087", "702367", "701755", "701756", "701758", "701765", "701766", "701767", "701769", "701775", "702184", "702306", "701782", "701784", "701797", "701804", "701821", "701822", "701823", "701829", "701831", "701842", "701843", "701845", "701849", "701856", "701872", "701874", "114498", "701892", "702349", "701896", "701898", "701899", "701905", "701908", "701911", "114500", "187562", "701934", "701935", "701937", "701942", "701943", "701947", "701950", "701955", "187567", "701965", "187573", "701988", "701997", "702002", "702013", "702217", "702015", "702280", "702016", "702019", "702020", "114502", "702023", "702289", "702031", "702035", "702037", "702041", "702046", "702048", "702057", "719674", "719765", "719680", "102102", "102135", "994567", "994524", "117906", "616762", "187836", "616770", "187842", "616820", "616828", "616841", "616855", "616869", "616881", "114690", "617012", "617016", "617037", "114006", "114001", "193691", "616737", "616739", "616740", "728228", "728228", "112585", "112595", "112621", "114126", "193698", "114223", "193736", "114146", "114253", "114200", "1063872", "771162", "1014376", "1018304", "574031", "574052", "573974", "154226", "154230", "154237", "115221", "101725", "591757", "101718", "111858", "117016", "114262", "193637", "598276", "113150", "598282", "115625", "957472", "598276", "153694", "952289", "722414", "952270", "722427", "722417", "101857", "101865", "101945", "101803", "661063", "777580", "729099", "113841", "729104", "834318", "729100", "165678", "729097", "729094", "729096", "101918", "591757", "661116", "112621", "114505", "112072", "114146", "112595", "929666", "777053", "777055", "777063", "777054", "661105", "661113", "926403", "926642", "929742", "926591", "926516", "926628", "186401", "690997", "113302", "113427", "113442", "690990", "186461", "186481", "113433", "113292", "113295", "186554", "113827", "186580", "724619", "691002", "113299", "139910", "140643", "141076", "139694", "139680", "141247", "140144", "140995", "139872", "139857", "708236", "808676", "808728", "819577", "187221", "591757", "154283", "154282", "154262", "154266")


databaseName <- "colecciones"
#table <- "taxonomia_itis"

options(rpostgre = list(
  "host" = "localhost",
  "port" = 5432,
  "user" = "user",
  "password" = "password"
))


db <- dbConnect(PostgreSQL(), dbname = databaseName, host = options()$rpostgre$host, 
                port = options()$rpostgre$port, user = options()$rpostgre$user, 
                password = options()$rpostgre$password)



#query <- sprintf("SELECT DISTINCT csid FROM public.chemspider_result_compound;", table)
#devuelve la clasificacion
out <- classification(list_loop, db='itis')
#devuelve resultado en datafra,e
df_out <- rbind(out)
#manda dataframe a postgresql
dbWriteTable(db, table, value = df_out, append = FALSE, row.names = FALSE)

#devuelve nombre aceptado
accept_name <- itis_acceptname(searchtsn = tsn_list)

#devuelve todos los registros
record_tsn <- itis_getrecord(tsn_list)

rapply(record_tsn, mean, how='list')


nrow(record_tsn)
ncol(df_record_tsn)
str(record_tsn)
record_tsn[1]$`661079`$acceptedNameList$tsn
record_tsn[1]$`661079`$acceptedNameList$acceptedNames
record_tsn[1]$`661079`$commonNameList$commonNames
record_tsn[1]$`661079`$hierarchyUp$parentName
record_tsn[1]$`661079`$hierarchyUp$parentTsn
record_tsn[1]$`661079`$hierarchyUp$rankName
record_tsn[1]$`661079`$hierarchyUp$taxonName
record_tsn[1]$`661079`$taxonAuthor$authorship
record_tsn[1]$`661079`$taxonAuthor$updateDate
record_tsn[1]$`661079`$taxRank$rankName
#record <- id2name(tsn_list, db= 'itis')

            
classification_faltante <- classification(faltantes, db = 'itis')
classification_df <-rbind(classification_faltantes)
table <- 'classification_faltantes'
dbWriteTable(db, table, value = classification_df, append = FALSE, row.names = FALSE)
